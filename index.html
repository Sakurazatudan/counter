<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>はとあげ山積み</title>
<style>
body { margin:0; overflow:hidden; background:#87CEEB; }
canvas { display:block; }
#message {
  position:absolute;
  top:20px;
  width:100%;
  text-align:center;
  font-size:2em;
  color:#fff;
  font-family:sans-serif;
  text-shadow: 1px 1px 3px #000;
}
</style>
</head>
<body>
<div id="message"></div>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const message = document.getElementById("message");

const hatoImg = new Image();
hatoImg.src = "hato.png";
const hatoAgeImg = new Image();
hatoAgeImg.src = "hatoage_only.png";

let count = 150; // デモ用の人数。後でJSON fetchに置き換え可
let pile = [];   // 山に積まれたはとあげ
let falling = []; // 落下中のはとあげ

// 1秒に1個ずつ落とす
setInterval(() => {
  if (pile.length + falling.length < count) {
    falling.push({
      x: canvas.width/2 + (Math.random()*100-50), // ランダムに左右ズレ
      y: -50,
      size: 48,
      speed: 5 + Math.random()*2
    });
  }
}, 200);

// 更新
function update() {
  // 落下処理
  for (let i=falling.length-1; i>=0; i--) {
    let f = falling[i];
    f.y += f.speed;
    if (f.y > canvas.height-80 - pile.length*0.2) { 
      // 着地 → 山に追加
      pile.push({
        x: f.x + (Math.random()*20-10),
        y: canvas.height-80 - (pile.length*0.2), // 高さに応じて積もる
        size: f.size
      });
      falling.splice(i,1);
    }
  }
}

// 描画
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // 山積み
  for (let p of pile) {
    ctx.drawImage(hatoAgeImg, p.x, p.y, p.size, p.size);
  }

  // 落下中
  for (let f of falling) {
    ctx.drawImage(hatoAgeImg, f.x, f.y, f.size, f.size);
  }

  // メッセージ
  if (pile.length >= count) {
    message.textContent = `🎉 はとあげ完成！(${pile.length}人) 🎉`;
  } else {
    message.textContent = `現在 ${pile.length}/${count} 人 → はとあげ ${pile.length}個`;
  }

  requestAnimationFrame(loop);
}

// ループ
function loop() {
  update();
  draw();
}
loop();
</script>
</body>
</html>
