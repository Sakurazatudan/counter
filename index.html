<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã¯ã¨ã‚ã’å±±ç©ã¿</title>
<style>
body { margin:0; overflow:hidden; background:#87CEEB; }
canvas { display:block; }
#message {
  position:absolute;
  top:20px;
  width:100%;
  text-align:center;
  font-size:2em;
  color:#fff;
  font-family:sans-serif;
  text-shadow: 1px 1px 3px #000;
}
</style>
</head>
<body>
<div id="message"></div>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const message = document.getElementById("message");

const hatoImg = new Image();
hatoImg.src = "hato.png";
const hatoAgeImg = new Image();
hatoAgeImg.src = "hatoage_only.png";

let count = 150; // ãƒ‡ãƒ¢ç”¨ã®äººæ•°ã€‚å¾Œã§JSON fetchã«ç½®ãæ›ãˆå¯
let pile = [];   // å±±ã«ç©ã¾ã‚ŒãŸã¯ã¨ã‚ã’
let falling = []; // è½ä¸‹ä¸­ã®ã¯ã¨ã‚ã’

// 1ç§’ã«1å€‹ãšã¤è½ã¨ã™
setInterval(() => {
  if (pile.length + falling.length < count) {
    falling.push({
      x: canvas.width/2 + (Math.random()*100-50), // ãƒ©ãƒ³ãƒ€ãƒ ã«å·¦å³ã‚ºãƒ¬
      y: -50,
      size: 48,
      speed: 5 + Math.random()*2
    });
  }
}, 200);

// æ›´æ–°
function update() {
  // è½ä¸‹å‡¦ç†
  for (let i=falling.length-1; i>=0; i--) {
    let f = falling[i];
    f.y += f.speed;
    if (f.y > canvas.height-80 - pile.length*0.2) { 
      // ç€åœ° â†’ å±±ã«è¿½åŠ 
      pile.push({
        x: f.x + (Math.random()*20-10),
        y: canvas.height-80 - (pile.length*0.2), // é«˜ã•ã«å¿œã˜ã¦ç©ã‚‚ã‚‹
        size: f.size
      });
      falling.splice(i,1);
    }
  }
}

// æç”»
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // å±±ç©ã¿
  for (let p of pile) {
    ctx.drawImage(hatoAgeImg, p.x, p.y, p.size, p.size);
  }

  // è½ä¸‹ä¸­
  for (let f of falling) {
    ctx.drawImage(hatoAgeImg, f.x, f.y, f.size, f.size);
  }

  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  if (pile.length >= count) {
    message.textContent = `ğŸ‰ ã¯ã¨ã‚ã’å®Œæˆï¼(${pile.length}äºº) ğŸ‰`;
  } else {
    message.textContent = `ç¾åœ¨ ${pile.length}/${count} äºº â†’ ã¯ã¨ã‚ã’ ${pile.length}å€‹`;
  }

  requestAnimationFrame(loop);
}

// ãƒ«ãƒ¼ãƒ—
function loop() {
  update();
  draw();
}
loop();
</script>
</body>
</html>
